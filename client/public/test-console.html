<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FogueHack ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«</title>
    <style>
      body {
        font-family: "Courier New", monospace;
        background: #000;
        color: #00ff00;
        margin: 0;
        padding: 20px;
        line-height: 1.4;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-section {
        border: 1px solid #00ff00;
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
      }
      button {
        background: #001100;
        color: #00ff00;
        border: 1px solid #00ff00;
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
        border-radius: 3px;
        font-family: inherit;
      }
      button:hover {
        background: #002200;
      }
      .output {
        background: #001100;
        border: 1px solid #004400;
        padding: 10px;
        margin: 10px 0;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
        border-radius: 3px;
      }
      .success {
        color: #00ff00;
      }
      .error {
        color: #ff4444;
      }
      .warning {
        color: #ffaa00;
      }
      .info {
        color: #4499ff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ® FogueHack ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h1>
      <p>ã“ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€FogueHackã‚²ãƒ¼ãƒ ã®å„ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>

      <div class="test-section">
        <h2>ğŸ“‹ åŸºæœ¬ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="runBasicTests()">åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="testGameFlow()">ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testAllSystems()">å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
        <div id="basic-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ”§ ã‚¨ãƒ©ãƒ¼æ¤œå‡ºãƒ»ä¿®æ­£</h2>
        <button onclick="runErrorDetection()">ã‚¨ãƒ©ãƒ¼æ¤œå‡ºå®Ÿè¡Œ</button>
        <button onclick="runErrorFixes()">ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Ÿè¡Œ</button>
        <button onclick="validateFinal()">æœ€çµ‚æ¤œè¨¼å®Ÿè¡Œ</button>
        <div id="error-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ¯ å€‹åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testMagicSystem()">é­”æ³•ã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testQuestSystem()">ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testCraftingSystem()">åˆæˆã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testCombatSystem()">æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ </button>
        <div id="system-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testSaveLoad()">ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰</button>
        <button onclick="testDataIntegrity()">ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§</button>
        <button onclick="testPerformance()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</button>
        <div id="data-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
        <button onclick="generateReport()">å®Œå…¨ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
        <button onclick="clearAllOutputs()">å‡ºåŠ›ã‚¯ãƒªã‚¢</button>
        <div id="summary-output" class="output"></div>
      </div>
    </div>

    <script>
      // å‡ºåŠ›ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
      function output(elementId, message, type = "info") {
        const element = document.getElementById(elementId);
        const timestamp = new Date().toLocaleTimeString();
        const className = type;
        element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        element.scrollTop = element.scrollHeight;
      }

      function clearOutput(elementId) {
        document.getElementById(elementId).innerHTML = "";
      }

      function clearAllOutputs() {
        ["basic-output", "error-output", "system-output", "data-output", "summary-output"].forEach(
          clearOutput,
        );
      }

      // åŸºæœ¬ãƒ†ã‚¹ãƒˆé–¢æ•°
      async function runBasicTests() {
        clearOutput("basic-output");
        output("basic-output", "åŸºæœ¬ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          // 1. ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
          if (typeof window.useGameState === "undefined") {
            throw new Error("useGameState ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          const gameState = window.useGameState.getState();
          if (!gameState.gameEngine) {
            throw new Error("ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          output("basic-output", "ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ– âœ…", "success");

          // 2. æ–°ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ†ã‚¹ãƒˆ
          gameState.startNewGame();
          if (gameState.phase !== "playing") {
            throw new Error("ã‚²ãƒ¼ãƒ é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ");
          }

          output("basic-output", "ã‚²ãƒ¼ãƒ é–‹å§‹ âœ…", "success");

          // 3. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å­˜åœ¨ç¢ºèª
          if (!gameState.player) {
            throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          output(
            "basic-output",
            `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ âœ… (Lv.${gameState.player.level}, HP:${gameState.player.hp}/${gameState.player.maxHp})`,
            "success",
          );

          // 4. ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ç”Ÿæˆç¢ºèª
          if (!gameState.dungeon || gameState.dungeon.length === 0) {
            throw new Error("ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          output(
            "basic-output",
            `ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ç”Ÿæˆ âœ… (${gameState.dungeon.length}x${gameState.dungeon[0].length})`,
            "success",
          );

          output("basic-output", "åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº† ğŸ‰", "success");
        } catch (error) {
          output("basic-output", `åŸºæœ¬ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, "error");
        }
      }

      async function testGameFlow() {
        clearOutput("basic-output");
        output("basic-output", "ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const gameState = window.useGameState.getState();
          gameState.startNewGame();

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•ãƒ†ã‚¹ãƒˆ
          const initialPos = { ...gameState.player.position };
          const directions = ["north", "south", "east", "west"];
          let moveCount = 0;

          for (const direction of directions) {
            try {
              gameState.movePlayer(direction);
              moveCount++;
              output("basic-output", `${direction}æ–¹å‘ç§»å‹• âœ…`, "success");
            } catch (error) {
              output("basic-output", `${direction}æ–¹å‘ç§»å‹• âŒ (${error.message})`, "warning");
            }
          }

          output(
            "basic-output",
            `ç§»å‹•ãƒ†ã‚¹ãƒˆå®Œäº†: ${moveCount}/4æ–¹å‘æˆåŠŸ`,
            moveCount > 0 ? "success" : "error",
          );

          // é­”æ³•ä½¿ç”¨ãƒ†ã‚¹ãƒˆ
          try {
            gameState.castHeal();
            output("basic-output", "ãƒ’ãƒ¼ãƒ«é­”æ³• âœ…", "success");
          } catch (error) {
            output("basic-output", `ãƒ’ãƒ¼ãƒ«é­”æ³• âŒ (${error.message})`, "warning");
          }

          // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªãƒ†ã‚¹ãƒˆ
          try {
            gameState.toggleInventory();
            output("basic-output", "ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ“ä½œ âœ…", "success");
          } catch (error) {
            output("basic-output", `ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ“ä½œ âŒ (${error.message})`, "error");
          }

          output("basic-output", "ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå®Œäº† ğŸ‰", "success");
        } catch (error) {
          output("basic-output", `ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, "error");
        }
      }

      async function testAllSystems() {
        clearOutput("basic-output");
        output("basic-output", "å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        const tests = [
          { name: "é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ", fn: () => testMagicSystemInternal() },
          { name: "ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ", fn: () => testQuestSystemInternal() },
          { name: "åˆæˆã‚·ã‚¹ãƒ†ãƒ ", fn: () => testCraftingSystemInternal() },
          { name: "ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰", fn: () => testSaveLoadInternal() },
        ];

        let passed = 0;
        for (const test of tests) {
          try {
            await test.fn();
            output("basic-output", `${test.name} âœ…`, "success");
            passed++;
          } catch (error) {
            output("basic-output", `${test.name} âŒ (${error.message})`, "error");
          }
        }

        const success = passed === tests.length;
        output(
          "basic-output",
          `å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†: ${passed}/${tests.length}`,
          success ? "success" : "error",
        );
      }

      // å€‹åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆç”¨ã®å†…éƒ¨é–¢æ•°
      function testMagicSystemInternal() {
        const gameState = window.useGameState.getState();
        gameState.startNewGame();

        const knownSpells = gameState.getKnownSpells();
        if (!knownSpells || knownSpells.length === 0) {
          throw new Error("ç¿’å¾—æ¸ˆã¿é­”æ³•ãŒã‚ã‚Šã¾ã›ã‚“");
        }

        // ãƒ’ãƒ¼ãƒ«é­”æ³•ãƒ†ã‚¹ãƒˆ
        const initialHp = gameState.player.hp;
        gameState.player.hp = Math.floor(gameState.player.maxHp * 0.5);
        gameState.castHeal();

        if (gameState.player.hp <= Math.floor(gameState.player.maxHp * 0.5)) {
          throw new Error("ãƒ’ãƒ¼ãƒ«åŠ¹æœãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“");
        }

        return `é­”æ³•ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${knownSpells.length}å€‹ã®é­”æ³•åˆ©ç”¨å¯èƒ½)`;
      }

      function testQuestSystemInternal() {
        const gameState = window.useGameState.getState();
        gameState.startNewGame();

        const availableQuests = gameState.getAvailableQuests();
        if (!availableQuests || availableQuests.length === 0) {
          throw new Error("åˆ©ç”¨å¯èƒ½ãªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“");
        }

        const firstQuest = availableQuests[0];
        const acceptResult = gameState.acceptQuest(firstQuest.id);
        if (!acceptResult) {
          throw new Error("ã‚¯ã‚¨ã‚¹ãƒˆå—è«¾ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }

        return `ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${availableQuests.length}å€‹ã®ã‚¯ã‚¨ã‚¹ãƒˆåˆ©ç”¨å¯èƒ½)`;
      }

      function testCraftingSystemInternal() {
        const gameState = window.useGameState.getState();
        gameState.startNewGame();

        const recipes = gameState.getAvailableRecipes();
        if (!recipes || recipes.length === 0) {
          throw new Error("åˆ©ç”¨å¯èƒ½ãªãƒ¬ã‚·ãƒ”ãŒã‚ã‚Šã¾ã›ã‚“");
        }

        const firstRecipe = recipes[0];
        const craftCheck = gameState.canCraftItem(firstRecipe.id);
        if (typeof craftCheck.canCraft !== "boolean") {
          throw new Error("åˆæˆãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“");
        }

        return `åˆæˆã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${recipes.length}å€‹ã®ãƒ¬ã‚·ãƒ”åˆ©ç”¨å¯èƒ½)`;
      }

      function testSaveLoadInternal() {
        const gameState = window.useGameState.getState();
        gameState.startNewGame();

        const originalLevel = gameState.player.level;
        const originalGold = gameState.player.gold;

        gameState.saveGame();
        gameState.player.level = originalLevel + 1;
        gameState.player.gold = originalGold + 100;

        gameState.loadGame();

        if (gameState.player.level !== originalLevel || gameState.player.gold !== originalGold) {
          throw new Error("ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ");
        }

        return "ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸";
      }

      // ã‚¨ãƒ©ãƒ¼æ¤œå‡ºãƒ»ä¿®æ­£é–¢æ•°
      async function runErrorDetection() {
        clearOutput("error-output");
        output("error-output", "ã‚¨ãƒ©ãƒ¼æ¤œå‡ºé–‹å§‹...", "info");

        try {
          if (typeof window.runErrorDetection === "function") {
            await window.runErrorDetection();
            output("error-output", "ã‚¨ãƒ©ãƒ¼æ¤œå‡ºå®Œäº† âœ…", "success");
          } else {
            output("error-output", "ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", "error");
          }
        } catch (error) {
          output("error-output", `ã‚¨ãƒ©ãƒ¼æ¤œå‡ºä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function runErrorFixes() {
        clearOutput("error-output");
        output("error-output", "ã‚¨ãƒ©ãƒ¼ä¿®æ­£é–‹å§‹...", "info");

        try {
          if (typeof window.runGameErrorFixes === "function") {
            await window.runGameErrorFixes();
            output("error-output", "ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Œäº† âœ…", "success");
          } else {
            output("error-output", "ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", "error");
          }
        } catch (error) {
          output("error-output", `ã‚¨ãƒ©ãƒ¼ä¿®æ­£ä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function validateFinal() {
        clearOutput("error-output");
        output("error-output", "æœ€çµ‚æ¤œè¨¼é–‹å§‹...", "info");

        try {
          if (typeof window.runFinalValidation === "function") {
            const result = await window.runFinalValidation();
            output("error-output", "æœ€çµ‚æ¤œè¨¼å®Œäº† âœ…", "success");
          } else {
            output("error-output", "æœ€çµ‚æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“", "error");
          }
        } catch (error) {
          output("error-output", `æœ€çµ‚æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // å€‹åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–¢æ•°
      async function testMagicSystem() {
        clearOutput("system-output");
        output("system-output", "é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const result = testMagicSystemInternal();
          output("system-output", result, "success");
        } catch (error) {
          output("system-output", `é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function testQuestSystem() {
        clearOutput("system-output");
        output("system-output", "ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const result = testQuestSystemInternal();
          output("system-output", result, "success");
        } catch (error) {
          output("system-output", `ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function testCraftingSystem() {
        clearOutput("system-output");
        output("system-output", "åˆæˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const result = testCraftingSystemInternal();
          output("system-output", result, "success");
        } catch (error) {
          output("system-output", `åˆæˆã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function testCombatSystem() {
        clearOutput("system-output");
        output("system-output", "æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const gameState = window.useGameState.getState();
          gameState.startNewGame();

          if (gameState.monsters.length === 0) {
            throw new Error("ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
          }

          const monsterCount = gameState.monsters.length;
          output(
            "system-output",
            `æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${monsterCount}ä½“ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç”Ÿæˆ)`,
            "success",
          );
        } catch (error) {
          output("system-output", `æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆé–¢æ•°
      async function testSaveLoad() {
        clearOutput("data-output");
        output("data-output", "ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const result = testSaveLoadInternal();
          output("data-output", result, "success");
        } catch (error) {
          output("data-output", `ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function testDataIntegrity() {
        clearOutput("data-output");
        output("data-output", "ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        try {
          const gameState = window.useGameState.getState();
          gameState.startNewGame();

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
          if (gameState.player.hp <= 0 || gameState.player.hp > gameState.player.maxHp) {
            throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼HPå€¤ãŒä¸æ­£ã§ã™");
          }

          if (gameState.player.level < 1) {
            throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ™ãƒ«ãŒä¸æ­£ã§ã™");
          }

          // ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
          if (gameState.dungeon.length === 0 || gameState.dungeon[0].length === 0) {
            throw new Error("ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚µã‚¤ã‚ºãŒä¸æ­£ã§ã™");
          }

          output("data-output", "ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèªå®Œäº† âœ…", "success");
        } catch (error) {
          output("data-output", `ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      async function testPerformance() {
        clearOutput("data-output");
        output("data-output", "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...", "info");

        const startTime = performance.now();

        try {
          const gameState = window.useGameState.getState();

          // 10å›ã®ã‚²ãƒ¼ãƒ é–‹å§‹
          for (let i = 0; i < 10; i++) {
            gameState.startNewGame();
          }

          // 100å›ã®ç§»å‹•
          for (let i = 0; i < 100; i++) {
            try {
              gameState.movePlayer("north");
            } catch (error) {
              // ç§»å‹•ã§ããªã„å ´åˆã¯ç„¡è¦–
            }
          }

          const endTime = performance.now();
          const duration = endTime - startTime;

          if (duration > 2000) {
            output("data-output", `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è­¦å‘Š: ${duration.toFixed(2)}ms`, "warning");
          } else {
            output("data-output", `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è‰¯å¥½: ${duration.toFixed(2)}ms`, "success");
          }
        } catch (error) {
          output("data-output", `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, "error");
        }
      }

      // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
      async function generateReport() {
        clearOutput("summary-output");
        output("summary-output", "å®Œå…¨ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆä¸­...", "info");

        const report = {
          timestamp: new Date().toLocaleString(),
          tests: [],
        };

        // å…¨ãƒ†ã‚¹ãƒˆã‚’é †æ¬¡å®Ÿè¡Œ
        const testSuites = [
          { name: "åŸºæœ¬æ©Ÿèƒ½", fn: runBasicTests },
          { name: "ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼", fn: testGameFlow },
          { name: "é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ", fn: testMagicSystem },
          { name: "ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ", fn: testQuestSystem },
          { name: "åˆæˆã‚·ã‚¹ãƒ†ãƒ ", fn: testCraftingSystem },
          { name: "æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ", fn: testCombatSystem },
          { name: "ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰", fn: testSaveLoad },
          { name: "ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§", fn: testDataIntegrity },
          { name: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹", fn: testPerformance },
        ];

        let passed = 0;
        for (const testSuite of testSuites) {
          try {
            await testSuite.fn();
            report.tests.push({ name: testSuite.name, status: "PASS" });
            passed++;
          } catch (error) {
            report.tests.push({ name: testSuite.name, status: "FAIL", error: error.message });
          }
        }

        const successRate = ((passed / testSuites.length) * 100).toFixed(1);

        output("summary-output", `=== FogueHack ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ ===`, "info");
        output("summary-output", `ç”Ÿæˆæ—¥æ™‚: ${report.timestamp}`, "info");
        output(
          "summary-output",
          `åˆæ ¼ç‡: ${passed}/${testSuites.length} (${successRate}%)`,
          "info",
        );
        output("summary-output", "", "info");

        report.tests.forEach((test) => {
          const status = test.status === "PASS" ? "âœ…" : "âŒ";
          output(
            "summary-output",
            `${status} ${test.name}`,
            test.status === "PASS" ? "success" : "error",
          );
          if (test.error) {
            output("summary-output", `   ã‚¨ãƒ©ãƒ¼: ${test.error}`, "error");
          }
        });

        if (passed === testSuites.length) {
          output(
            "summary-output",
            "\nğŸ‰ å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼FogueHackã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚",
            "success",
          );
        } else {
          output(
            "summary-output",
            "\nâš ï¸ ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆã§å•é¡ŒãŒç™ºè¦‹ã•ã‚Œã¾ã—ãŸã€‚ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚",
            "warning",
          );
        }
      }

      // åˆæœŸåŒ–
      window.addEventListener("load", () => {
        output("summary-output", "FogueHack ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«æº–å‚™å®Œäº†", "success");
        output("summary-output", "å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„", "info");
      });
    </script>
  </body>
</html>
