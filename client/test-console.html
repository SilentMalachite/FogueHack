<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FogueHack ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«</title>
    <style>
      body {
        font-family: "Courier New", monospace;
        background: #000;
        color: #0f0;
        margin: 0;
        padding: 20px;
        line-height: 1.4;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .test-section {
        border: 1px solid #0f0;
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
      }
      button {
        background: #001100;
        color: #0f0;
        border: 1px solid #0f0;
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
        border-radius: 3px;
        font-family: inherit;
      }
      button:hover {
        background: #002200;
      }
      .output {
        background: #001100;
        border: 1px solid #004400;
        padding: 10px;
        margin: 10px 0;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
        border-radius: 3px;
      }
      .success {
        color: #00ff00;
      }
      .error {
        color: #ff4444;
      }
      .warning {
        color: #ffaa00;
      }
      .info {
        color: #4499ff;
      }
    </style>
    <!-- ViteçµŒç”±ã§å¿…è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‚’å…¬é–‹ã™ã‚‹ -->
    <script type="module" src="/src/globalExpose.ts"></script>
    <script type="module" src="/src/testRunner.ts"></script>
    <script type="module" src="/src/errorDetection.ts"></script>
    <script type="module" src="/src/finalValidation.ts"></script>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ® FogueHack ãƒ†ã‚¹ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h1>
      <p>ã“ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€FogueHackã‚²ãƒ¼ãƒ ã®å„ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚</p>

      <div class="test-section">
        <h2>ğŸ“‹ åŸºæœ¬ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="runBasicTests()">åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="testGameFlow()">ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testAllSystems()">å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
        <div id="basic-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ”§ ã‚¨ãƒ©ãƒ¼æ¤œå‡ºãƒ»ä¿®æ­£</h2>
        <button onclick="runErrorDetection()">ã‚¨ãƒ©ãƒ¼æ¤œå‡ºå®Ÿè¡Œ</button>
        <button onclick="runErrorFixes()">ã‚¨ãƒ©ãƒ¼ä¿®æ­£å®Ÿè¡Œ</button>
        <button onclick="validateFinal()">æœ€çµ‚æ¤œè¨¼å®Ÿè¡Œ</button>
        <div id="error-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ¯ å€‹åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testMagicSystem()">é­”æ³•ã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testQuestSystem()">ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testCraftingSystem()">åˆæˆã‚·ã‚¹ãƒ†ãƒ </button>
        <button onclick="testCombatSystem()">æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ </button>
        <div id="system-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testSaveLoad()">ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰</button>
        <button onclick="testDataIntegrity()">ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§</button>
        <button onclick="testPerformance()">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</button>
        <div id="data-output" class="output"></div>
      </div>

      <div class="test-section">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
        <button onclick="generateReport()">å®Œå…¨ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
        <button onclick="clearAllOutputs()">å‡ºåŠ›ã‚¯ãƒªã‚¢</button>
        <div id="summary-output" class="output"></div>
      </div>
    </div>

    <script>
      function output(elementId, message, type = "info") {
        const element = document.getElementById(elementId);
        const timestamp = new Date().toLocaleTimeString();
        const className = type;
        element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
        element.scrollTop = element.scrollHeight;
      }

      function clearOutput(elementId) { document.getElementById(elementId).innerHTML = ""; }
      function clearAllOutputs() { ["basic-output","error-output","system-output","data-output","summary-output"].forEach(clearOutput); }

      async function runBasicTests() {
        clearOutput("basic-output");
        output("basic-output","åŸºæœ¬ãƒ†ã‚¹ãƒˆé–‹å§‹...","info");
        try {
          if (typeof window.useGameState === "undefined") throw new Error("useGameState ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          const gameState = window.useGameState.getState();
          if (!gameState.gameEngine) throw new Error("ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“");
          output("basic-output","ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ– âœ…","success");
          gameState.startNewGame();
          if (gameState.phase !== "playing") throw new Error("ã‚²ãƒ¼ãƒ é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ");
          output("basic-output","ã‚²ãƒ¼ãƒ é–‹å§‹ âœ…","success");
          if (!gameState.player) throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
          output("basic-output",`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ âœ… (Lv.${gameState.player.level}, HP:${gameState.player.hp}/${gameState.player.maxHp})`,`success");
          if (!gameState.dungeon || gameState.dungeon.length === 0) throw new Error("ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
          output("basic-output",`ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ç”Ÿæˆ âœ… (${gameState.dungeon.length}x${gameState.dungeon[0].length})`,`success");
          output("basic-output","åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº† ğŸ‰","success");
        } catch (e) { output("basic-output",`åŸºæœ¬ãƒ†ã‚¹ãƒˆå¤±æ•—: ${e.message}`,"error"); }
      }

      async function testGameFlow() {
        clearOutput("basic-output");
        output("basic-output","ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹...","info");
        try {
          const gameState = window.useGameState.getState();
          gameState.startNewGame();
          const directions = ["north","south","east","west"]; let moveCount=0;
          for (const d of directions) { try { gameState.movePlayer(d); moveCount++; output("basic-output",`${d}æ–¹å‘ç§»å‹• âœ…","success"); } catch(err) { output("basic-output",`${d}æ–¹å‘ç§»å‹• âŒ (${err.message})","warning"); } }
          output("basic-output",`ç§»å‹•ãƒ†ã‚¹ãƒˆå®Œäº†: ${moveCount}/4æ–¹å‘æˆåŠŸ`, moveCount>0?"success":"error");
          try { gameState.castHeal(); output("basic-output","ãƒ’ãƒ¼ãƒ«é­”æ³• âœ…","success"); } catch(err) { output("basic-output",`ãƒ’ãƒ¼ãƒ«é­”æ³• âŒ (${err.message})","warning"); }
          try { gameState.toggleInventory(); output("basic-output","ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ“ä½œ âœ…","success"); } catch(err) { output("basic-output",`ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ“ä½œ âŒ (${err.message})","error"); }
          output("basic-output","ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå®Œäº† ğŸ‰","success");
        } catch(e) { output("basic-output",`ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆå¤±æ•—: ${e.message}`,"error"); }
      }

      async function testAllSystems() {
        clearOutput("basic-output");
        output("basic-output","å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...","info");
        const tests=[{name:"é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ",fn:()=>testMagicSystemInternal()},{name:"ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ",fn:()=>testQuestSystemInternal()},{name:"åˆæˆã‚·ã‚¹ãƒ†ãƒ ",fn:()=>testCraftingSystemInternal()},{name:"ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰",fn:()=>testSaveLoadInternal()}];
        let passed=0; for(const t of tests){ try{ await t.fn(); output("basic-output",`${t.name} âœ…","success"); passed++; }catch(err){ output("basic-output",`${t.name} âŒ (${err.message})","error"); } }
        output("basic-output",`å…¨ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†: ${passed}/${tests.length}`, passed===tests.length?"success":"error");
      }

      function testMagicSystemInternal(){ const s=window.useGameState.getState(); s.startNewGame(); const ks=s.getKnownSpells(); if(!ks||ks.length===0) throw new Error("ç¿’å¾—æ¸ˆã¿é­”æ³•ãŒã‚ã‚Šã¾ã›ã‚“"); const p=s.player; p.hp=Math.floor(p.maxHp*0.5); s.castHeal(); if(p.hp<=Math.floor(p.maxHp*0.5)) throw new Error("ãƒ’ãƒ¼ãƒ«åŠ¹æœãŒé©ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“"); return `é­”æ³•ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${ks.length}å€‹ã®é­”æ³•åˆ©ç”¨å¯èƒ½)`; }
      function testQuestSystemInternal(){ const s=window.useGameState.getState(); s.startNewGame(); const aq=s.getAvailableQuests(); if(!aq||aq.length===0) throw new Error("åˆ©ç”¨å¯èƒ½ãªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“"); const ok=s.acceptQuest(aq[0].id); if(!ok) throw new Error("ã‚¯ã‚¨ã‚¹ãƒˆå—è«¾ã«å¤±æ•—ã—ã¾ã—ãŸ"); return `ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${aq.length}å€‹ã®ã‚¯ã‚¨ã‚¹ãƒˆåˆ©ç”¨å¯èƒ½)`; }
      function testCraftingSystemInternal(){ const s=window.useGameState.getState(); s.startNewGame(); const r=s.getAvailableRecipes(); if(!r||r.length===0) throw new Error("åˆ©ç”¨å¯èƒ½ãªãƒ¬ã‚·ãƒ”ãŒã‚ã‚Šã¾ã›ã‚“"); const ck=s.canCraftItem(r[0].id); if(typeof ck.canCraft!=="boolean") throw new Error("åˆæˆãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“"); return `åˆæˆã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${r.length}å€‹ã®ãƒ¬ã‚·ãƒ”åˆ©ç”¨å¯èƒ½)`; }
      function testSaveLoadInternal(){ const s=window.useGameState.getState(); s.startNewGame(); const lv=s.player.level, g=s.player.gold, ph=s.phase; s.saveGame(); s.loadGame(); const ok=(lv===s.player.level&&g===s.player.gold&&ph===s.phase); return ok?"ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèªå®Œäº† âœ…":"ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã«å·®ç•°ãŒã‚ã‚Šã¾ã™"; }

      async function testMagicSystem(){ clearOutput("system-output"); output("system-output","é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const r=testMagicSystemInternal(); output("system-output",r,"success"); }catch(e){ output("system-output",`é­”æ³•ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }
      async function testQuestSystem(){ clearOutput("system-output"); output("system-output","ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const r=testQuestSystemInternal(); output("system-output",r,"success"); }catch(e){ output("system-output",`ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }
      async function testCraftingSystem(){ clearOutput("system-output"); output("system-output","åˆæˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const r=testCraftingSystemInternal(); output("system-output",r,"success"); }catch(e){ output("system-output",`åˆæˆã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }
      async function testCombatSystem(){ clearOutput("system-output"); output("system-output","æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const s=window.useGameState.getState(); s.startNewGame(); if(s.monsters.length===0) throw new Error("ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“"); output("system-output",`æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ (${s.monsters.length}ä½“ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç”Ÿæˆ)`,`success`); }catch(e){ output("system-output",`æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }

      async function testSaveLoad(){ clearOutput("data-output"); output("data-output","ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const r=testSaveLoadInternal(); output("data-output",r,"success"); }catch(e){ output("data-output",`ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }
      async function testDataIntegrity(){ clearOutput("data-output"); output("data-output","ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); try{ const s=window.useGameState.getState(); s.startNewGame(); if(s.player.hp<=0||s.player.hp>s.player.maxHp) throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼HPå€¤ãŒä¸æ­£ã§ã™"); if(s.player.level<1) throw new Error("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ™ãƒ«ãŒä¸æ­£ã§ã™"); if(s.dungeon.length===0||s.dungeon[0].length===0) throw new Error("ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚µã‚¤ã‚ºãŒä¸æ­£ã§ã™"); output("data-output","ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ç¢ºèªå®Œäº† âœ…","success"); }catch(e){ output("data-output",`ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }
      async function testPerformance(){ clearOutput("data-output"); output("data-output","ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...","info"); const t0=performance.now(); try{ const s=window.useGameState.getState(); for(let i=0;i<100;i++){ s.movePlayer(["north","south","east","west"][i%4]); } const dt=(performance.now()-t0).toFixed(1); output("data-output",`ç§»å‹•100å›å‡¦ç†æ™‚é–“: ${dt}ms`,`success`); }catch(e){ output("data-output",`ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¨ãƒ©ãƒ¼: ${e.message}`,"error"); } }

      function generateReport(){ clearOutput("summary-output"); if (typeof window.runGameTests === "function") { const results = window.runGameTests(); results.forEach(r=>{ output("summary-output",`${r.passed?"âœ…":"âŒ"} ${r.name} ${r.details?"- "+r.details:""}`, r.passed?"success":"error"); }); } else { output("summary-output","ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“","error"); } }

      async function runErrorDetection(){ clearOutput("error-output"); if(typeof window.runErrorDetection==="function"){ await window.runErrorDetection(); output("error-output","ã‚¨ãƒ©ãƒ¼æ¤œå‡ºå®Œäº†","success"); } else { output("error-output","ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error"); } }
      async function runErrorFixes(){ clearOutput("error-output"); output("error-output","ï¼ˆãƒ‡ãƒ¢ï¼‰è‡ªå‹•ä¿®æ­£ã¯åˆ¥é€”å®Ÿè£…å¯¾è±¡","warning"); }
      async function validateFinal(){ clearOutput("error-output"); if(typeof window.runFinalValidation==="function"){ await window.runFinalValidation(); output("error-output","æœ€çµ‚æ¤œè¨¼å®Œäº†","success"); } else { output("error-output","æœ€çµ‚æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“","error"); } }
    </script>
  </body>
</html>
